# StatisticsAPI
Микросервис для ведениия счетчика статистики с взаимодействием на основе REST_API запросов

Модель статистики в данном сервисе имеет следующие поля:

* id - Уникальный номер статистики в базе
* date - Дата события
* views - Кол-во показов
* clicks - Кол-во кликов
* cost - Стоимость кликов (в рублях с точностью до копеек)
* cpc - средняя стоимость клика (cost/clicks)
* cpm - средняя стоимость 1000 показов (cost/views * 1000)

# Инструкция по исполльзованию api

Для использования api сервиса, пользователю необходим access_token, который он может получить после авторизации на сайте.

**API для авторизации**
Запрос | Значение
-------|----------
POST auth/token/login | Принимает в тело запроса параметры username -никнейм админа и password пароль. В качестве ответа отдает токен в формате {'token': 'some_token'}
POST auth/token/logout | Выход из системы, также принимает в тело запроса username и password, удаляет полученный в ходе авторизации токен из системы, что делает его недействительным для дальнейшего использования

**В качестве примера проведем авторизацию в системе. Для проверки функций нашего микросервиса воспользуемся программой Postman**

Отправим POST запрос на адрес /auth/token/login/ и передадим в тело запроса наш никнейм и пароль - admin admin

![image](https://user-images.githubusercontent.com/79451112/134825473-b149d854-0397-41d9-a022-a52f3cd80ba3.png)

Полученный токен передадим в head в поле Authorisation

![image](https://user-images.githubusercontent.com/79451112/134825507-010a24e6-7524-4318-9c3a-2bff6b3d3e60.png)

Теперь мы можем использовать весь функционал микросервиса

**Получение, отправка и сброс статистики**

Запрос | Значение
-------|----------
GET api/statistics/ | Принимает в тело запроса поля from и to, в которых указан промежуток времени. Время указывается в формате "YYYY-MM-DD". В качестве ответа отдает статистику, входящей в указанный период, отсортированную по дате в формате [{"id": "ID события", "date": "Дата события", "views": "Кол-во показов", "clicks": "Кол-во кликов", "cost", "cpc", "cpm"}, ...]
POST api/statistics/ | Создает новое поле статистики. Принимает в тело запроса данные date, views, click, cost
DELETE api/statistics | Делает полный сброс статистики

**Пример использования**

Для начала создадим несколько объектов статистики в нашей системе. Для этого отправим POST запрос по адресу /api/statistics/ с полями date, views, click, cost в теле запроса

![image](https://user-images.githubusercontent.com/79451112/134826287-bb0c8ffa-c31f-4784-8439-c8f0a1ab0312.png)

Как мы видим, система сохранила наши данные и автоматически расчитала поля cpc и cpm

В нашей базе сейчас имеются следующие поля

![image](https://user-images.githubusercontent.com/79451112/134826422-05be3a08-54d8-4cf6-9722-92799b4a59bc.png)


Теперь получим статистику в период с 2021-09-09 по 2021-09-25

![image](https://user-images.githubusercontent.com/79451112/134826478-4417a8b1-190a-4234-8d99-191f64e3f7c0.png)

Мы получаем следующий ответ:

```
[
    {
        "id": 8,
        "date": "2021-09-09",
        "views": 233,
        "clicks": 12314,
        "cost": 12.0,
        "cpc": 0.0009745005684586649,
        "cpm": 51.502145922746784
    },
    {
        "id": 7,
        "date": "2021-09-14",
        "views": 420,
        "clicks": 1337,
        "cost": 13.0,
        "cpc": 0.009723261032161555,
        "cpm": 30.952380952380953
    },
    {
        "id": 9,
        "date": "2021-09-23",
        "views": 233,
        "clicks": 12314,
        "cost": 12.0,
        "cpc": 0.0009745005684586649,
        "cpm": 51.502145922746784
    },
    {
        "id": 12,
        "date": "2021-09-25",
        "views": 233,
        "clicks": 12314,
        "cost": 12.0,
        "cpc": 0.0009745005684586649,
        "cpm": 51.502145922746784
    }
]
```
Как мы видим, статистика за 2021-09-01 и за 2021-09-30 не попала в наш ответ

Теперь сбросим всю статистику в базе

![image](https://user-images.githubusercontent.com/79451112/134826535-dd91ea02-b2b3-4be5-997a-f92b775e6126.png)

Если заглянем в админ.панель, то увидим, что все поля были удалены

![image](https://user-images.githubusercontent.com/79451112/134826547-8195dc8a-5b25-4706-9891-6514dbc68cc4.png)
